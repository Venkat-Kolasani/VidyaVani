<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidyaVani Demo Simulator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        .phone-simulator {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #e9ecef;
        }

        .processing-dashboard {
            background: #fff;
            padding: 30px;
        }

        .phone-interface {
            background: #2c3e50;
            border-radius: 20px;
            padding: 20px;
            color: white;
            max-width: 300px;
            margin: 0 auto;
        }

        .phone-screen {
            background: #34495e;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 200px;
        }

        .menu-display {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .demo-questions {
            margin-bottom: 20px;
        }

        .demo-questions h3 {
            color: #4CAF50;
            margin-bottom: 15px;
        }

        .question-btn {
            display: block;
            width: 100%;
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            text-align: left;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .question-btn:hover {
            background: #2980b9;
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .key {
            background: #95a5a6;
            border: none;
            padding: 15px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .key:hover {
            background: #7f8c8d;
        }

        .pipeline-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .pipeline-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .pipeline-step.active {
            border-left-color: #4CAF50;
            box-shadow: 0 2px 10px rgba(76, 175, 80, 0.2);
        }

        .pipeline-step.processing {
            border-left-color: #ff9800;
            animation: pulse 1.5s infinite;
        }

        .pipeline-step.completed {
            border-left-color: #4CAF50;
            background: #f1f8e9;
        }

        .pipeline-step.error {
            border-left-color: #f44336;
            background: #ffebee;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            color: white;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .step-details {
            font-size: 0.9em;
            color: #666;
        }

        .step-timing {
            font-size: 0.8em;
            color: #999;
            margin-left: auto;
        }

        .response-display {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .response-text {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .play-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .play-btn:hover {
            background: #45a049;
        }

        .controls {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .control-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }

        .control-btn:hover {
            background: #5a6fd8;
        }

        .control-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .metrics-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }

        .metric-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-ready { background-color: #4CAF50; }
        .status-processing { background-color: #ff9800; }
        .status-error { background-color: #f44336; }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .phone-simulator {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìû VidyaVani Demo Simulator</h1>
            <p>Interactive demonstration of AI-powered IVR learning system</p>
        </div>

        <div class="demo-grid">
            <!-- Phone Simulator Side -->
            <div class="phone-simulator">
                <div class="phone-interface">
                    <div class="phone-screen">
                        <div class="menu-display" id="menu-display">
                            <div><span class="status-indicator status-ready"></span>System Ready</div>
                            <div style="margin-top: 15px;">
                                <strong>VidyaVani Learning System</strong><br>
                                Press 1 for English<br>
                                Press 2 for Telugu<br>
                                Or select a demo question below
                            </div>
                        </div>
                    </div>

                    <div class="demo-questions">
                        <h3>üìö Demo Questions</h3>
                        <div id="question-list">
                            <!-- Questions will be loaded here -->
                        </div>
                    </div>

                    <div class="keypad">
                        <button class="key" onclick="pressKey('1')">1</button>
                        <button class="key" onclick="pressKey('2')">2</button>
                        <button class="key" onclick="pressKey('3')">3</button>
                        <button class="key" onclick="pressKey('4')">4</button>
                        <button class="key" onclick="pressKey('5')">5</button>
                        <button class="key" onclick="pressKey('6')">6</button>
                        <button class="key" onclick="pressKey('7')">7</button>
                        <button class="key" onclick="pressKey('8')">8</button>
                        <button class="key" onclick="pressKey('9')">9</button>
                        <button class="key" onclick="pressKey('*')">*</button>
                        <button class="key" onclick="pressKey('0')">0</button>
                        <button class="key" onclick="pressKey('#')">#</button>
                    </div>
                </div>
            </div>

            <!-- Processing Dashboard Side -->
            <div class="processing-dashboard">
                <h2>üîÑ Processing Pipeline</h2>
                
                <div class="pipeline-container">
                    <div class="pipeline-step" id="step-input">
                        <div class="step-icon" style="background: #3498db;">üé§</div>
                        <div class="step-content">
                            <div class="step-title">Voice Input</div>
                            <div class="step-details">Waiting for question...</div>
                        </div>
                        <div class="step-timing">-</div>
                    </div>

                    <div class="pipeline-step" id="step-stt">
                        <div class="step-icon" style="background: #9b59b6;">üî§</div>
                        <div class="step-content">
                            <div class="step-title">Speech-to-Text</div>
                            <div class="step-details">Google Cloud STT processing</div>
                        </div>
                        <div class="step-timing">-</div>
                    </div>

                    <div class="pipeline-step" id="step-rag">
                        <div class="step-icon" style="background: #e67e22;">üß†</div>
                        <div class="step-content">
                            <div class="step-title">RAG Engine</div>
                            <div class="step-details">NCERT content retrieval + GPT-5-nano</div>
                        </div>
                        <div class="step-timing">-</div>
                    </div>

                    <div class="pipeline-step" id="step-tts">
                        <div class="step-icon" style="background: #27ae60;">üîä</div>
                        <div class="step-content">
                            <div class="step-title">Text-to-Speech</div>
                            <div class="step-details">Google Cloud TTS generation</div>
                        </div>
                        <div class="step-timing">-</div>
                    </div>

                    <div class="pipeline-step" id="step-delivery">
                        <div class="step-icon" style="background: #2c3e50;">üìû</div>
                        <div class="step-content">
                            <div class="step-title">Response Delivery</div>
                            <div class="step-details">Audio playback via Exotel</div>
                        </div>
                        <div class="step-timing">-</div>
                    </div>
                </div>

                <div class="metrics-display">
                    <div class="metric-card">
                        <div class="metric-value" id="total-time">-</div>
                        <div class="metric-label">Total Time (s)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="stt-time">-</div>
                        <div class="metric-label">STT Time (s)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="rag-time">-</div>
                        <div class="metric-label">RAG Time (s)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="tts-time">-</div>
                        <div class="metric-label">TTS Time (s)</div>
                    </div>
                </div>

                <div class="response-display" id="response-display" style="display: none;">
                    <div class="response-text" id="response-text"></div>
                    <div class="audio-controls">
                        <button class="play-btn" onclick="playResponse()">
                            ‚ñ∂Ô∏è Play Response
                        </button>
                        <span id="audio-status">Ready to play</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn" onclick="resetDemo()">üîÑ Reset Demo</button>
            <button class="control-btn" onclick="startRecording()" id="record-btn">üé§ Start Recording</button>
            <button class="control-btn" onclick="exportResults()">üìä Export Results</button>
            <button class="control-btn" onclick="toggleFullscreen()">üñ•Ô∏è Fullscreen</button>
        </div>
    </div>

    <script>
        let currentLanguage = 'english';
        let isProcessing = false;
        let processingStartTime = null;
        let stepTimings = {};
        let currentResponse = null;

        // Initialize demo
        document.addEventListener('DOMContentLoaded', function() {
            loadDemoQuestions();
            resetPipeline();
        });

        async function loadDemoQuestions() {
            try {
                const response = await fetch('/api/demo/questions');
                const data = await response.json();
                
                const questionList = document.getElementById('question-list');
                questionList.innerHTML = '';
                
                data.demo_questions.forEach((question, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'question-btn';
                    btn.textContent = `${index + 1}. ${question}`;
                    btn.onclick = () => askDemoQuestion(question);
                    questionList.appendChild(btn);
                });
                
                console.log(`Loaded ${data.demo_questions.length} demo questions`);
            } catch (error) {
                console.error('Failed to load demo questions:', error);
                document.getElementById('question-list').innerHTML = 
                    '<div style="color: #f44336;">Failed to load questions</div>';
            }
        }

        function pressKey(key) {
            if (isProcessing) return;
            
            const menuDisplay = document.getElementById('menu-display');
            
            if (key === '1') {
                currentLanguage = 'english';
                menuDisplay.innerHTML = `
                    <div><span class="status-indicator status-ready"></span>English Selected</div>
                    <div style="margin-top: 15px;">
                        <strong>Class 10 Science</strong><br>
                        Press 1 to browse topics<br>
                        Press 2 to ask question<br>
                        Or select demo question below
                    </div>
                `;
            } else if (key === '2') {
                currentLanguage = 'telugu';
                menuDisplay.innerHTML = `
                    <div><span class="status-indicator status-ready"></span>Telugu Selected</div>
                    <div style="margin-top: 15px;">
                        <strong>‡∞ï‡±ç‡∞≤‡∞æ‡∞∏‡±ç 10 ‡∞∏‡±à‡∞®‡±ç‡∞∏‡±ç</strong><br>
                        1 - ‡∞µ‡∞ø‡§∑‡∞Ø‡∞æ‡∞≤‡±Å ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø<br>
                        2 - ‡∞™‡±ç‡∞∞‡∞∂‡±ç‡∞® ‡∞Ö‡∞°‡∞ó‡∞Ç‡∞°‡∞ø<br>
                        ‡∞≤‡±á‡∞¶‡∞æ ‡∞°‡±Ü‡∞Æ‡±ã ‡∞™‡±ç‡∞∞‡∞∂‡±ç‡∞® ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø
                    </div>
                `;
            }
        }

        async function askDemoQuestion(question) {
            if (isProcessing) return;
            
            isProcessing = true;
            processingStartTime = Date.now();
            
            // Update menu display
            const menuDisplay = document.getElementById('menu-display');
            menuDisplay.innerHTML = `
                <div><span class="status-indicator status-processing"></span>Processing Question</div>
                <div style="margin-top: 15px;">
                    <strong>Question:</strong><br>
                    "${question}"
                </div>
            `;
            
            // Start pipeline animation
            await simulateProcessingPipeline(question);
        }

        async function simulateProcessingPipeline(question) {
            try {
                // Step 1: Voice Input (simulated)
                await updatePipelineStep('step-input', 'processing', 'Receiving question...', 0.5);
                await sleep(500);
                await updatePipelineStep('step-input', 'completed', `Question received: "${question.substring(0, 30)}..."`, 0.5);
                
                // Step 2: Speech-to-Text (simulated)
                await updatePipelineStep('step-stt', 'processing', 'Converting speech to text...', null);
                await sleep(1200);
                await updatePipelineStep('step-stt', 'completed', 'Text conversion complete', 1.2);
                
                // Step 3: RAG Engine (get actual cached response)
                await updatePipelineStep('step-rag', 'processing', 'Searching NCERT content...', null);
                
                const response = await fetch('/api/demo/response', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: question })
                });
                
                const responseData = await response.json();
                await sleep(800);
                
                if (responseData.response) {
                    await updatePipelineStep('step-rag', 'completed', 'Response generated successfully', 2.1);
                    currentResponse = responseData.response;
                } else {
                    await updatePipelineStep('step-rag', 'error', 'No cached response found', 2.1);
                    currentResponse = "I don't have information about that topic. Please try another question.";
                }
                
                // Step 4: Text-to-Speech (simulated)
                await updatePipelineStep('step-tts', 'processing', 'Generating audio response...', null);
                await sleep(1000);
                await updatePipelineStep('step-tts', 'completed', 'Audio generation complete', 1.0);
                
                // Step 5: Response Delivery
                await updatePipelineStep('step-delivery', 'processing', 'Delivering response...', null);
                await sleep(300);
                await updatePipelineStep('step-delivery', 'completed', 'Response delivered', 0.3);
                
                // Show final response
                showResponse(currentResponse);
                updateMetrics();
                
            } catch (error) {
                console.error('Pipeline error:', error);
                await updatePipelineStep('step-rag', 'error', 'Processing failed', null);
            }
            
            isProcessing = false;
        }

        async function updatePipelineStep(stepId, status, details, timing) {
            const step = document.getElementById(stepId);
            const stepDetails = step.querySelector('.step-details');
            const stepTiming = step.querySelector('.step-timing');
            
            // Remove all status classes
            step.classList.remove('active', 'processing', 'completed', 'error');
            
            // Add new status
            step.classList.add(status);
            stepDetails.textContent = details;
            
            if (timing !== null) {
                stepTiming.textContent = `${timing}s`;
                stepTimings[stepId] = timing;
            }
        }

        function showResponse(responseText) {
            const responseDisplay = document.getElementById('response-display');
            const responseTextEl = document.getElementById('response-text');
            
            responseTextEl.textContent = responseText;
            responseDisplay.style.display = 'block';
            
            // Update menu display
            const menuDisplay = document.getElementById('menu-display');
            menuDisplay.innerHTML = `
                <div><span class="status-indicator status-ready"></span>Response Ready</div>
                <div style="margin-top: 15px;">
                    Press 1 for detailed explanation<br>
                    Press 2 for new question<br>
                    Press 9 for main menu
                </div>
            `;
        }

        function updateMetrics() {
            const totalTime = (Date.now() - processingStartTime) / 1000;
            
            document.getElementById('total-time').textContent = totalTime.toFixed(1);
            document.getElementById('stt-time').textContent = (stepTimings['step-stt'] || 0).toFixed(1);
            document.getElementById('rag-time').textContent = (stepTimings['step-rag'] || 0).toFixed(1);
            document.getElementById('tts-time').textContent = (stepTimings['step-tts'] || 0).toFixed(1);
        }

        function playResponse() {
            if (!currentResponse) return;
            
            // Simulate audio playback
            const audioStatus = document.getElementById('audio-status');
            audioStatus.textContent = 'Playing...';
            
            // Use speech synthesis for demo
            const utterance = new SpeechSynthesisUtterance(currentResponse);
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            
            utterance.onend = () => {
                audioStatus.textContent = 'Playback complete';
            };
            
            speechSynthesis.speak(utterance);
        }

        function resetDemo() {
            isProcessing = false;
            currentResponse = null;
            stepTimings = {};
            
            resetPipeline();
            
            const menuDisplay = document.getElementById('menu-display');
            menuDisplay.innerHTML = `
                <div><span class="status-indicator status-ready"></span>System Ready</div>
                <div style="margin-top: 15px;">
                    <strong>VidyaVani Learning System</strong><br>
                    Press 1 for English<br>
                    Press 2 for Telugu<br>
                    Or select a demo question below
                </div>
            `;
            
            document.getElementById('response-display').style.display = 'none';
            
            // Reset metrics
            document.getElementById('total-time').textContent = '-';
            document.getElementById('stt-time').textContent = '-';
            document.getElementById('rag-time').textContent = '-';
            document.getElementById('tts-time').textContent = '-';
        }

        function resetPipeline() {
            const steps = ['step-input', 'step-stt', 'step-rag', 'step-tts', 'step-delivery'];
            
            steps.forEach(stepId => {
                const step = document.getElementById(stepId);
                step.classList.remove('active', 'processing', 'completed', 'error');
                
                const stepTiming = step.querySelector('.step-timing');
                stepTiming.textContent = '-';
            });
            
            // Reset step details
            document.querySelector('#step-input .step-details').textContent = 'Waiting for question...';
            document.querySelector('#step-stt .step-details').textContent = 'Google Cloud STT processing';
            document.querySelector('#step-rag .step-details').textContent = 'NCERT content retrieval + GPT-5-nano';
            document.querySelector('#step-tts .step-details').textContent = 'Google Cloud TTS generation';
            document.querySelector('#step-delivery .step-details').textContent = 'Audio playback via Exotel';
        }

        function startRecording() {
            alert('üé§ Recording functionality would integrate with actual microphone input in production. For demo, please use the demo questions.');
        }

        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                language: currentLanguage,
                processing_times: stepTimings,
                total_time: document.getElementById('total-time').textContent,
                response: currentResponse
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `vidyavani_demo_results_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>